<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Análise do Perfil do Cliente</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        body { background: #000; color: #D26900; }
        .sidebar {
            width: 240px;
            background: #111;
            padding: 24px 18px;
            min-height: 100vh;
        }
        .sidebar img {
            max-width: 80%;
            display: block;
            margin: 0 auto 32px auto;
        }
        .sidebar a {
            display: block;
            color: #fff;
            text-decoration: none;
            margin: 12px 0;
            font-size: 1.06rem;
            transition: color 0.18s;
        }
        .sidebar a.active, .sidebar a:hover {
            color: #ca5d09;
            font-weight: 600;

        .main-content { flex-grow: 1; padding: 40px; }
        label, h1, h2 { color: #fff; }
        .card { background: #181818; color: #fff; border: 2px solid #D26900; border-radius: 1.5rem; }
        .btn-primary { background: #D26900; border: none; }
        .btn-primary:hover { background: #a04c00; }
        .resultado-ia { white-space: pre-wrap; background: #202020; border-radius: 1rem; padding: 1.2rem; margin-top: 1.3rem; font-size: 1.09rem; border: 1.5px solid #2d2d2d; color: #ffd580; }
    </style>
</head>
<body>
<div style="display: flex;">
    <!-- Sidebar -->
    <div class="sidebar">
        {% include 'sidebar.html' %}
    </div>

    <!-- Área principal -->
    <div class="main-content container">
        <h1 class="mb-4">Análise do Perfil do Cliente</h1>

        <!-- Formulário do Perfil do Cliente -->
        <form id="formPerfilCliente" class="row g-3 mb-4">
            <div class="col-md-6">
                <label for="nome" class="form-label">Nome</label>
                <input type="text" class="form-control" id="nome" required>
            </div>
            <div class="col-md-3">
                <label for="idade" class="form-label">Idade / faixa etária</label>
                <input type="text" class="form-control" id="idade" placeholder="Ex: 35 ou 26-35">
            </div>
            <div class="col-md-3">
                <label for="objetivo" class="form-label">Objetivo</label>
                <select id="objetivo" class="form-select">
                    <option>Comprar</option>
                    <option>Alugar</option>
                    <option>Investir</option>
                    <option>Outro</option>
                </select>
            </div>
            <div class="col-md-4">
                <label class="form-label">Preferência de contato</label>
                <select id="contato" class="form-select">
                    <option>WhatsApp</option>
                    <option>Telefone</option>
                    <option>E-mail</option>
                    <option>Presencial</option>
                </select>
            </div>
            <div class="col-md-8">
                <label class="form-label">Foco principal</label>
                <div class="form-check"><input class="form-check-input" type="checkbox" id="localizacao"><label class="form-check-label" for="localizacao">Localização</label></div>
                <div class="form-check"><input class="form-check-input" type="checkbox" id="preco"><label class="form-check-label" for="preco">Preço</label></div>
                <div class="form-check"><input class="form-check-input" type="checkbox" id="imovel_novo"><label class="form-check-label" for="imovel_novo">Imóvel novo</label></div>
                <div class="form-check"><input class="form-check-input" type="checkbox" id="imovel_usado"><label class="form-check-label" for="imovel_usado">Imóvel usado</label></div>
                <div class="form-check"><input class="form-check-input" type="checkbox" id="tempo_construcao"><label class="form-check-label" for="tempo_construcao">Tempo de construção</label></div>
                <div class="form-check"><input class="form-check-input" type="checkbox" id="tamanho"><label class="form-check-label" for="tamanho">Tamanho (m²/quartos)</label></div>
                <div class="form-check"><input class="form-check-input" type="checkbox" id="lazer"><label class="form-check-label" for="lazer">Área de lazer/comodidades</label></div>
                <div class="form-check"><input class="form-check-input" type="checkbox" id="seguranca"><label class="form-check-label" for="seguranca">Segurança</label></div>
                <div class="form-check"><input class="form-check-input" type="checkbox" id="documentacao"><label class="form-check-label" for="documentacao">Documentação</label></div>
                <div class="form-check"><input class="form-check-input" type="checkbox" id="outro_foco"><label class="form-check-label" for="outro_foco">Outro</label></div>
            </div>
            <div class="col-md-4">
                <label class="form-label">Estilo de decisão</label>
                <select id="decisao" class="form-select">
                    <option>Rápido</option>
                    <option>Cauteloso</option>
                    <option>Precisa de apoio</option>
                </select>
            </div>
            <div class="col-md-4">
                <label class="form-label">Aceita sugestões facilmente?</label>
                <select id="sugestoes" class="form-select">
                    <option>Sim</option>
                    <option>Não</option>
                    <option>Questiona muito</option>
                </select>
            </div>
            <div class="col-md-4">
                <label class="form-label">Interesse em novidades</label>
                <select id="novidades" class="form-select">
                    <option>Sim</option>
                    <option>Não</option>
                </select>
            </div>
            <div class="col-12">
                <label for="obs" class="form-label">Observações do corretor</label>
                <textarea class="form-control" id="obs" rows="2"></textarea>
            </div>
            <div class="col-12 d-grid mt-3">
                <button type="submit" class="btn btn-primary btn-lg">Analisar Perfil</button>
            </div>
        </form>
        <div id="resultadoIa" class="resultado-ia" style="display: none;"></div>
    </div>
</div>
<script>
    document.getElementById('formPerfilCliente').addEventListener('submit', async function(e) {
    e.preventDefault();
    const data = {
        nome: document.getElementById('nome').value,
        idade: document.getElementById('idade').value,
        objetivo: document.getElementById('objetivo').value,
        contato: document.getElementById('contato').value,
        foco: [
            document.getElementById('localizacao').checked ? 'Localização' : null,
            document.getElementById('preco').checked ? 'Preço' : null,
            document.getElementById('imovel_novo').checked ? 'Imóvel novo' : null,
            document.getElementById('imovel_usado').checked ? 'Imóvel usado' : null,
            document.getElementById('tempo_construcao').checked ? 'Tempo de construção' : null,
            document.getElementById('tamanho').checked ? 'Tamanho (m²/quartos)' : null,
            document.getElementById('lazer').checked ? 'Área de lazer/comodidades' : null,
            document.getElementById('seguranca').checked ? 'Segurança' : null,
            document.getElementById('documentacao').checked ? 'Documentação' : null,
            document.getElementById('outro_foco').checked ? 'Outro' : null
        ].filter(Boolean),
        decisao: document.getElementById('decisao').value,
        sugestoes: document.getElementById('sugestoes').value,
        novidades: document.getElementById('novidades').value,
        observacoes: document.getElementById('obs').value,
    };
const resultadoDiv = document.getElementById('resultadoIa');
    resultadoDiv.style.display = 'block';
    // Spinner Bootstrap com mensagem
    resultadoDiv.innerHTML = `
        <div class="d-flex align-items-center">
            <div class="spinner-border text-warning me-2" role="status"></div>
            <span style="color:#ffd580;">Analisando perfil do cliente... Aguarde!</span>
        </div>
    `;

    const resp = await fetch('/analisar_perfil', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
    });
    const json = await resp.json();

    if (json.resultado) {
        let html = json.resultado
            .replace(/\*\*(.*?)\*\*/g, '<b>$1</b>')
            .replace(/\n\n/g, '<br><br>')
            .replace(/\n/g, '<br>');
        resultadoDiv.innerHTML = html;
    } else {
        resultadoDiv.innerHTML = 'Ocorreu um erro na análise. Tente novamente.';
    }
});
</script>
</body>
</html>